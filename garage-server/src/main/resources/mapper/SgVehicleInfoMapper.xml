<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yixin.garage.dao.vehicle.SgVehicleInfoMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.yixin.garage.entity.vehicle.SgVehicleInfo">
        <id column="ID" property="id" />
        <result column="CREATE_TIME" property="createTime" />
        <result column="CREATOR_DEPARTMENT_ID" property="creatorDepartmentId" />
        <result column="CREATOR_DEPARTMENT_NAME" property="creatorDepartmentName" />
        <result column="CREATOR_ID" property="creatorId" />
        <result column="CREATOR_NAME" property="creatorName" />
        <result column="IS_DELETED" property="deleted" />
        <result column="UPDATE_TIME" property="updateTime" />
        <result column="UPDATOR_DEPARTMENT_ID" property="updatorDepartmentId" />
        <result column="UPDATOR_DEPARTMENT_NAME" property="updatorDepartmentName" />
        <result column="UPDATOR_ID" property="updatorId" />
        <result column="UPDATOR_NAME" property="updatorName" />
        <result column="VERSION" property="version" />
        <result column="actual_storage_time" property="actualStorageTime" />
        <result column="alix_num" property="alixNum" />
        <result column="brand" property="brand" />
        <result column="brand_model" property="brandModel" />
        <result column="brand_modelStr" property="brandModelstr" />
        <result column="brandStr" property="brandStr" />
        <result column="business_type" property="businessType" />
        <result column="color" property="color" />
        <result column="damageDesc" property="damageDesc" />
        <result column="dispose_cer_num" property="disposeCerNum" />
        <result column="dispose_Handover" property="disposeHandover" />
        <result column="is_battery_work" property="isBatteryWork" />
        <result column="is_drag_garage" property="isDragGarage" />
        <result column="is_driving_license" property="isDrivingLicense" />
        <result column="is_key" property="isKey" />
        <result column="is_new_key" property="isNewKey" />
        <result column="is_normal_start" property="isNormalStart" />
        <result column="is_Spare" property="isSpare" />
        <result column="is_tyre_model" property="isTyreModel" />
        <result column="is_licNum_Car" property="isLicnumCar" />
        <result column="left_front_num" property="leftFrontNum" />
        <result column="left_rear_num" property="leftRearNum" />
        <result column="lessee" property="lessee" />
        <result column="lic_num" property="licNum" />
        <result column="mileage" property="mileage" />
        <result column="model" property="model" />
        <result column="modelStr" property="modelStr" />
        <result column="oil_quantity" property="oilQuantity" />
        <result column="property_right_type" property="propertyRightType" />
        <result column="remark" property="remark" />
        <result column="remove_GPS" property="removeGps" />
        <result column="right_front_num" property="rightFrontNum" />
        <result column="right_rear_num" property="rightRearNum" />
        <result column="sgGarageInfo_Id" property="sgGarageInfoId" />
        <result column="stat" property="stat" />
        <result column="vehicle_class" property="vehicleClass" />
        <result column="vehicle_classStr" property="vehicleClassstr" />
        <result column="vehicle_cross" property="vehicleCross" />
        <result column="vehicle_source" property="vehicleSource" />
        <result column="video_number" property="videoNumber" />
        <result column="vin" property="vin" />
        <result column="is_update" property="isUpdate" />
        <result column="lease_property" property="leaseProperty" />


    </resultMap>


    <resultMap id="vehcleDTOMap" type="com.yixin.garage.dto.vehicle.SgVehicleInfoDTO">
        <id column="ID" property="id" />
        <result column="CREATE_TIME" property="createTime" />
        <result column="CREATOR_DEPARTMENT_ID" property="creatorDepartmentId" />
        <result column="CREATOR_DEPARTMENT_NAME" property="creatorDepartmentName" />
        <result column="CREATOR_ID" property="creatorId" />
        <result column="CREATOR_NAME" property="creatorName" />
        <result column="IS_DELETED" property="deleted" />
        <result column="UPDATE_TIME" property="updateTime" />
        <result column="UPDATOR_DEPARTMENT_ID" property="updatorDepartmentId" />
        <result column="UPDATOR_DEPARTMENT_NAME" property="updatorDepartmentName" />
        <result column="UPDATOR_ID" property="updatorId" />
        <result column="UPDATOR_NAME" property="updatorName" />
        <result column="VERSION" property="version" />

        <result column="actual_storage_time" property="actualStorageTime" />
        <result column="alix_num" property="alixNum" />
        <result column="brand" property="brand" />
        <result column="brand_model" property="brandModel" />
        <result column="brand_modelStr" property="brandModelStr" />
        <result column="brandStr" property="brandStr" />
        <result column="business_type" property="businessType" />
        <result column="color" property="color" />
        <result column="damageDesc" property="damageDesc" />
        <result column="dispose_cer_num" property="disposeCerNum" />
        <result column="dispose_Handover" property="disposeHandover" />
        <result column="is_battery_work" property="isBatteryWork" />
        <result column="is_drag_garage" property="isDragGarage" />
        <result column="is_driving_license" property="isDrivingLicense" />
        <result column="is_key" property="isKey" />
        <result column="is_new_key" property="isNewKey" />
        <result column="is_normal_start" property="isNormalStart" />
        <result column="is_Spare" property="isSpare" />
        <result column="is_tyre_model" property="isTyreModel" />
        <result column="is_licNum_Car" property="isLicnumCar" />
        <result column="left_front_num" property="leftFrontNum" />
        <result column="left_rear_num" property="leftRearNum" />
        <result column="lessee" property="lessee" />
        <result column="lic_num" property="licNum" />
        <result column="mileage" property="mileage" />
        <result column="model" property="model" />
        <result column="modelStr" property="modelStr" />
        <result column="oil_quantity" property="oilQuantity" />
        <result column="property_right_type" property="propertyRightType" />
        <result column="remark" property="remark" />
        <result column="remove_GPS" property="removeGps" />
        <result column="right_front_num" property="rightFrontNum" />
        <result column="right_rear_num" property="rightRearNum" />
        <result column="sgGarageInfo_Id" property="sgGarageInfoId" />
        <result column="stat" property="stat" />
        <result column="vehicle_class" property="vehicleClass" />
        <result column="vehicle_classStr" property="vehicleClassStr" />
        <result column="vehicle_cross" property="vehicleCross" />
        <result column="vehicle_source" property="vehicleSource" />
        <result column="video_number" property="videoNumber" />
        <result column="vin" property="vin" />
        <result column="is_update" property="isUpdate" />
        <result column="lease_property" property="leaseProperty" />

        <result column="garage_name" property="sgGarageName" />
        <result column="garage_addresss" property="sgGarageAddresss" />
        <result column="actual_start_time" property="actualStartTime" />
        <result column="task_num" property="taskNum" />

    </resultMap>


    <sql id="buildQuerySql">
        <if test="dto.vin != null and dto.vin !=''">
            AND a.vin like concat('%',#{dto.vin},'%')
        </if>
        <if test="dto.alixNum != null and dto.alixNum !=''">
            AND a.alix_num like concat('%',#{dto.alixNum},'%')
        </if>
        <if test="dto.licNum != null and dto.licNum !=''">
            AND a.lic_Num like concat('%',#{dto.licNum},'%')
        </if>
        <if test="dto.brand != null and dto.brand !=''">
            AND a.brand = #{dto.brand}
        </if>
        <if test="dto.brandModel != null and dto.brandModel !=''">
            AND a.brand_model = #{dto.brandModel}
        </if>
        <if test="dto.vehicleClass != null and dto.vehicleClass !=''">
            AND a.vehicle_class = #{dto.vehicleClass}
        </if>
        <if test="dto.model != null and dto.model !=''">
            AND a.model = #{dto.model}
        </if>
        <if test="dto.sgGarageInfoId != null and dto.sgGarageInfoId !=''">
            AND a.sgGarageInfo_Id = #{dto.sgGarageInfoId}
        </if>
        <if test="dto.vehicleSource != null and dto.vehicleSource !=''">
            AND a.vehicle_source = #{dto.vehicleSource}
        </if>
        <if test="dto.propertyRightType != null and dto.propertyRightType !=''">
            AND a.property_right_type = #{dto.propertyRightType}
        </if>
        <if test="dto.stat != null ">
            AND a.stat = #{dto.stat}
        </if>
        <if test="dto.businessType != null and dto.businessType !=''">
            AND a.business_type = #{dto.businessType}
        </if>
        <if test="garageAdmins != null and garageAdmins.size > 0">
            AND a.sgGarageInfo_Id IN
            <foreach collection="garageAdmins" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        ORDER BY a.CREATE_TIME DESC
    </sql>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        a.ID, CREATE_TIME, CREATOR_DEPARTMENT_ID, CREATOR_DEPARTMENT_NAME, CREATOR_ID, CREATOR_NAME, IS_DELETED, UPDATE_TIME, UPDATOR_DEPARTMENT_ID, UPDATOR_DEPARTMENT_NAME, UPDATOR_ID, UPDATOR_NAME, VERSION, actual_storage_time, alix_num, brand, brand_model, brand_modelStr, brandStr, business_type, color, damageDesc, dispose_cer_num, dispose_Handover, is_battery_work, is_drag_garage, is_driving_license, is_key, is_new_key, is_normal_start, is_Spare, is_tyre_model, is_licNum_Car, left_front_num, left_rear_num, lessee, lic_num, mileage, model, modelStr, oil_quantity, property_right_type, remark, remove_GPS, right_front_num, right_rear_num, sgGarageInfo_Id, stat, vehicle_class, vehicle_classStr, vehicle_cross, vehicle_source, video_number, vin, is_update,lease_property
    </sql>

    <sql id="Vehicle_Column_List">
        a.ID, a.CREATE_TIME, a.CREATOR_DEPARTMENT_ID, a.CREATOR_DEPARTMENT_NAME, a.CREATOR_ID, a.CREATOR_NAME, a.IS_DELETED, a.UPDATE_TIME, a.UPDATOR_DEPARTMENT_ID, a.UPDATOR_DEPARTMENT_NAME, a.UPDATOR_ID, a.UPDATOR_NAME, a.VERSION, a.actual_storage_time, a.alix_num, a.brand, a.brand_model, a.brand_modelStr, a.brandStr, a.business_type, a.color, a.damageDesc, a.dispose_cer_num, a.dispose_Handover, a.is_battery_work, a.is_drag_garage, a.is_driving_license, a.is_key, a.is_new_key, a.is_normal_start, a.is_Spare, a.is_tyre_model, a.is_licNum_Car, a.left_front_num, a.left_rear_num, a.lessee, a.lic_num, a.mileage, a.model, a.modelStr, a.oil_quantity, a.property_right_type, a.remark, a.remove_GPS, a.right_front_num, a.right_rear_num, a.sgGarageInfo_Id, a.stat, a.vehicle_class, a.vehicle_classStr, a.vehicle_cross, a.vehicle_source, a.video_number, a.vin , a.is_update,a.lease_property
    </sql>

    <select id="getBill" parameterType="java.lang.String" resultMap="vehcleDTOMap">
        SELECT <include refid="Base_Column_List"/> FROM sg_vehicle_info WHERE IS_DELETED = 0 AND ID = #{sgVehicleId}
    </select>

    <!-- 查询在库车辆，临时出库车辆信息查询 -->
    <sql id="queryFreeVeh">
        AND a.stat = 0
        <if test="dto.alixNum != null and dto.alixNum !=''">
            AND a.alix_num like concat('%',#{dto.alixNum},'%')
        </if>
        <if test="dto.vin != null and dto.vin !=''">
            AND a.vin like concat('%',#{dto.vin},'%')
        </if>
    </sql>


    <select id="pageQuery" parameterType="com.yixin.garage.dto.vehicle.SgVehicleInfoDTO" resultMap="vehcleDTOMap">
        SELECT
        <include refid="Vehicle_Column_List"/>
        FROM
        sg_vehicle_info a
        WHERE a.IS_DELETED = 0
        <choose>
             <when test='dto.sign == "0"'>
                 <include refid="buildQuerySql"/>
             </when>
            <when test='dto.sign == "1"'>
                <include refid="queryFreeVeh"/>
            </when>
        </choose>
    </select>

    <sql id="orderPageQuerySql">
        <if test="dto.taskNum != null and dto.taskNum !=''">   <!-- 任务单号 -->
            AND b.task_num like concat('%',#{dto.taskNum},'%')
        </if>
        <if test="dto.alixNum != null and dto.alixNum !=''">   <!-- alix申请编号 -->
            AND a.alix_num like concat('%',#{dto.alixNum},'%')
        </if>
        <if test="dto.vin != null and dto.vin !=''">   <!-- 车架号 -->
            AND a.vin like concat('%',#{dto.vin},'%')
        </if>
        <if test="dto.licNum != null and dto.licNum !=''">  <!-- 车牌号 -->
            AND a.lic_Num like concat('%',#{dto.licNum},'%')
        </if>
        <if test="dto.vehicleSource != null and dto.vehicleSource !=''">   <!-- 车辆来源 -->
            AND a.vehicle_source = #{dto.vehicleSource}
        </if>
        <if test="dto.propertyRightType != null and dto.propertyRightType !=''">   <!-- 车辆类型 -->
            AND a.property_right_type = #{dto.propertyRightType}
        </if>
        <if test="dto.brand != null and dto.brand !=''">  <!-- 车辆四级 -->
            AND a.brand = #{dto.brand}
        </if>
        <if test="dto.brandModel != null and dto.brandModel !=''">
            AND a.brand_model = #{dto.brandModel}
        </if>
        <if test="dto.vehicleClass != null and dto.vehicleClass !=''">
            AND a.vehicle_class = #{dto.vehicleClass}
        </if>
        <if test="dto.model != null and dto.model !=''">   <!-- 车辆四级 -->
            AND a.model = #{dto.model}
        </if>
        <if test="dto.sgGarageInfoId != null and dto.sgGarageInfoId !=''">   <!-- 所在车库 -->
            AND a.sgGarageInfo_Id = #{dto.sgGarageInfoId}
        </if>
        <if test="dto.stat != null">   <!-- 车俩状态 -->
            AND a.stat = #{dto.stat}
        </if>
        <if test="dto.businessType != null and dto.businessType !=''">  <!-- 业务状态 -->
            AND a.business_type = #{dto.businessType}
        </if>

        <if test="dto.createTimeBegin != null ">   <!-- 创建时间开始 -->
            AND date_format(b.CREATE_TIME,'%Y-%m-%d') >= date_format(#{dto.createTimeBegin},'%Y-%m-%d')
        </if>
        <if test="dto.createTimeEnd != null ">    <!-- 创建时间结束 -->
            AND date_format(b.CREATE_TIME,'%Y-%m-%d') &lt;= date_format(#{dto.createTimeEnd},'%Y-%m-%d')
        </if>

        ORDER BY a.CREATE_TIME DESC
    </sql>

    <select id="orderPageQuery" parameterType="com.yixin.garage.dto.vehicle.SgVehicleInfoDTO" resultMap="vehcleDTOMap">
        SELECT
        <include refid="Vehicle_Column_List"/>,c.garage_name garage_name,c.garage_addresss garage_addresss,b.actual_start_time actual_start_time,b.task_num task_num
        FROM
        sg_vehicle_info a
        LEFT JOIN sg_garage_order b ON a.ID = b.sgVehicle_id
        LEFT JOIN sg_garage_info c ON a.sgGarageInfo_Id = c.ID
        WHERE a.IS_DELETED = 0 AND b.IS_DELETED = 0 AND c.IS_DELETED = 0
        <include refid="orderPageQuerySql"/>
    </select>


</mapper>
